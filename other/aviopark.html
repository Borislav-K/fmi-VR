<!DOCTYPE html>

<html lang="bg">
<head>
    <title>Авиопарк</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script src="../libs/three.min.js"></script>
    <script src="../libs/StereoEffect.js"></script>
    <script src="../libs/stats.min.js"></script>
    <script src="../libs/WebGL.js"></script>
    <script src="../libs/vax.js"></script>
    <script src="plane.js"></script>
</head>

<body>
<script>
    vaxInitParallax();
    scene.background = new THREE.Color(0x559BEB);
    scene.add(new THREE.AmbientLight(0xffffff, 0.3));
    light.position.set(0, 1000, 0);

    const groundWidthX = 800,
        groundWidthZ = 3000,
        grassToCementRatio = 3,
        planeDistance = groundWidthZ / 8;
    camera.far = groundWidthZ;
    camera.position.set(0, 80, groundWidthZ / 2);
    camera.updateProjectionMatrix();

    var groundGeometry = new THREE.BoxGeometry(groundWidthX, 5, groundWidthZ),
        grassMaterial = new THREE.MeshLambertMaterial({color: 'green'});

    var ground = new THREE.Group(),
        leftGroundPiece = new THREE.Mesh(groundGeometry, grassMaterial),
        rightGroundPiece = leftGroundPiece.clone(),
        middleGroundPiece = new THREE.Mesh(groundGeometry, new THREE.MeshLambertMaterial({color: 'grey'}));

    middleGroundPiece.scale.x = 1 / grassToCementRatio;
    middleGroundPiece.position.set(groundWidthX / grassToCementRatio, 0.1, 0);
    rightGroundPiece.translateX(2 * groundWidthX / grassToCementRatio);
    ground.add(leftGroundPiece, rightGroundPiece, middleGroundPiece);
    ground.translateX(-groundWidthX / grassToCementRatio);
    scene.add(ground);

    var planes = [];
    for (let i = 1; i <= 10; i++) {
        let planeSize = groundWidthZ / 150 * THREE.Math.randFloat(0.5, 1),
            chosenColour = randomColour(),
            inverseColour = new THREE.Color(1 - chosenColour.r, 1 - chosenColour.g, 1 - chosenColour.b);

        [buildPlane(planeSize, chosenColour, inverseColour), buildPlane(planeSize, inverseColour, chosenColour)]
            .forEach(function (plane, isRight) {
                plane.rotation.set(-Math.PI / 2, 0, isRight ? -Math.PI / 2 : Math.PI / 2);
                plane.position.set(
                    isRight ? groundWidthX / 3 : -groundWidthX / 3,
                    85,
                    planeDistance * (-8 + i)
                );
                plane.isRight = isRight;
                planes.push(plane);
            });
    }
    scene.add(...planes);

    function animate() {
        planes.forEach(function (plane) {
            plane.translateX(plane.isRight ? 3 : -3);
            if (plane.position.z >= camera.position.z) {
                plane.position.z = -groundWidthZ / 2;
            }
        })
    }

    function randomColour() {
        return new THREE.Color(THREE.Math.randFloat(0.0, 1), THREE.Math.randFloat(0, 1), THREE.Math.randFloat(0, 1));
    }
</script>
</body>
</html>


